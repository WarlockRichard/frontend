<div *ngIf="isLoaded">

  <bs-filters *ngIf="list.length"
              [filters]="filters"
              (filterChange)="filterChange($event)"></bs-filters>

  <div class="card">
    <div class="card-header" [ngSwitch]="parentId">
      <ng-template [ngSwitchCase]="'null'"><b>{{ 'T_GROUPS' | translate }}</b></ng-template>
      <ng-template ngSwitchDefault><b>{{ 'T_CHILD_GROUPS' | translate }}</b></ng-template>
    </div>
    <div class="card-block">
      <button class="btn btn-primary mb-1"
              type="button"
              title="{{ 'T_ACTION_CREATE' | translate }}"
              [routerLink]="['/admin/groups/create', parentId!='null' ? { parentId: parentId } : {}]"><i class="fa fa-group mr-h"></i>
        {{ parentId!='null' ? ('T_ACTION_CREATE_CHILD_GROUP'| translate) : ('T_ACTION_CREATE' | translate )}}
      </button>

      <button *ngIf="list.length"
              class="btn btn-default mb-1"
              type="button"
              title="{{ 'T_ACTION_EXPAND' | translate }}"
              (click)="changeInnerGroupState()">
      <span [ngSwitch]="innerGroupState">
          <ng-template [ngSwitchCase]="true">
               <i class="fa fa-chevron-up mr-h"></i>
              {{ 'T_ACTION_HIDE' | translate }}
          </ng-template>
          <ng-template ngSwitchDefault>
             <i class="fa fa-chevron-down mr-h"></i>
              {{ 'T_ACTION_EXPAND' | translate }}
          </ng-template>
      </span>
      </button>

      <ul class="list-group border-1 group-header">
        <li class="d-flex justify-content-between align-items-center">
          <b class="col-md-2 mt-1 mr-2 pb-1">#</b>
          <b class="col-md-5">{{ 'T_GROUP_NAME' | translate }}</b>
          <b class="actions-column col-md-5 pr-3">{{ 'T_ACTION' | translate }}</b>
        </li>
      </ul>

      <accordion class="group-list-accordion">
        <accordion-group *ngFor="let group of list"
                         class="accordion-group"
                         #accordionGroup
                         [isOpen]="innerGroupState">
          <div accordion-heading>
            <ul class="list-group">
              <li class="d-flex justify-content-between align-items-center">
                <p class="col-md-2 mt-1 mr-2">{{ group.id }}</p>
                <div class="col-md-5">
                  <a [routerLink]="['/admin/groups/', group.id]">{{ group.name }}</a>
                  <button *ngIf="group.hasChildren" type="button" class="btn btn-link btn-sm">
                    <i class="fa"
                       [ngClass]="{'fa-chevron-up': accordionGroup?.isOpen, 'fa-chevron-down': !accordionGroup?.isOpen }"></i>
                  </button>
                </div>
                <div class="action-column col-md-5 pr-3 text-right">
                  <button type="button"
                          class="btn btn-sm btn-danger ml-1"
                          title="{{ 'T_ACTION_DELETE' | translate }}"
                          bsConfirm
                          [message]="'T_CONFIRM_MESSAGE_DELETE_GROUP' | translate"
                          (confirm)="delete(group.id)"><i class="fa fa-trash"></i> {{ 'T_ACTION_DELETE' | translate }}
                  </button>
                </div>
              </li>
            </ul>
          </div>
          <bs-child-group-list *ngIf="group.hasChildren"
                               embedded
                               [parentId]="group.id"
                               [innerGroupState]="innerGroupState"></bs-child-group-list>
        </accordion-group>
      </accordion>

      <ul class="list-group empty-list text-center" *ngIf="!list.length">
        <li class="d-flex justify-content-between mt-1">
          <p class="w-100">{{ 'T_EMPTY' | translate }}</p>
        </li>
      </ul>

      <bs-pagination [meta]="meta"
                     (queryParamsChange)="pageQueryParamsChanged($event)"></bs-pagination>
    </div>
  </div>
</div>
